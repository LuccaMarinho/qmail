.TH AUTHUP 8 2018-10-19
.SH NAME
authup \- offer SMTP or POP3 authentication
.SH SYNOPSIS
.B authup
.I protocol
.I prog
.SH DESCRIPTION
.B authup
speaks just enough SMTP (AUTH LOGIN or PLAIN)
or POP3 (USER-PASS)
to parse a username and password.
It then runs
.I prog
via the
.B checkpassword
interface.

.B authup
is most commonly invoked from
.B tcpserver
or
.B sslserver
as root, so that
.B checkpassword
can run
.B ofmipd
(or
.BR qmail-smtpd )
or
.B qmail-pop3d
under the UID of the authenticated user.

.B authup
waits for
.I prog
to finish.
It prints an error message if
.I prog
crashes or exits nonzero.
If authentication failed, it waits 5 seconds before printing the message.

.B authup
neither performs encryption nor refuses to operate without it.
For security, make it available over the network only by means of
another program that encrypts the connection.
.SH "ENVIRONMENT VARIABLES"
The authenticated user is available to child processes as
.BR AUTHUP_USER .

If
.B AUTHUP_SASL_BROKEN_CLIENTS
is set,
.B authup
will additionally advertise AUTH support in a second, non-standard way
to interoperate with Outlook Express 4, Exchange 5,
and other SMTP clients that implement an obsolete version of the AUTH command.

Under
.BR authup,
.B qmail-queue
runs with the privileges of the authenticated user.
Therefore, if
.B ofmipd
(or
.BR qmail-smtpd )
has the QMAILQUEUE patch applied,
your configured queue wrapper will too.
This can be useful for user-controlled filtering.
.SH "CONTROL FILES"
.TP 5
.I smtpgreeting / pop3greeting
SMTP and POP3 greeting messages.
Default:
.IR me ,
if that is supplied;
otherwise
.B authup
will refuse to run.
The first word of the greeting
should be the current host's name.
.TP 5
.I timeoutsmtpd / timeoutpop3d
Number of seconds
.B authup
will wait for each new buffer of data from the remote SMTP or POP3 client.
Default: 1200.
.SH "COMPATIBILITY"
While
.B CRAM-MD5
is available in most SMTP AUTH patches, and
.B APOP
is available in
.BR qmail-popup ,
neither is currently supported by
.BR authup .
If you rely on them, please share your use case with the author.
.SH "EXAMPLES"
See
.IR https://schmonz.com/qmail/acceptutils .
.SH "AUTHOR"
.B Amitai Schleier <schmonz-web-acceptutils@schmonz.com>
.SH "SEE ALSO"
reup(8),
checknotroot(8),
fixsmtpio(8),
stunnel(8),
qmail-qfilter-ofmipd-queue(8),
ofmipd(8),
qmail-pop3d(8),
qmail-popup(8).
